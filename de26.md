<details>
<summary>1 модуль</summary>

---

<details>
<summary>ISP</summary>

---

```
hostnamectl hostname isp; exec bash
mkdir /etc/net/ifaces/ens20
mkdir /etc/net/ifaces/ens21
mkdir /etc/net/ifaces/ens22
vim /etc/net/ifaces/ens20/options
	DISABLED=no
	TYPE=eth
	BOOTPOROTO=static
	CONFIG_IPV4=yes
cp /etc/net/ifaces/ens20/options /etc/net/ifaces/ens21
cp /etc/net/ifaces/ens20/options /etc/net/ifaces/ens22
vim /etc/net/ifaces/ens20/options
	BOOTPROTO=dhcp
echo 172.16.1.1/28 > /etc/net/ifaces/ens21/ipv4address
echo 172.16.2.1/28 > /etc/net/ifaces/ens22/ipv4address
vim /etc/net/sysctl.conf
	net.ipv4.ip_forward = 0
systemctl restart network
apt-get update && apt-get install iptables -y && apt-get reinstall tzdata -y
timedatectl set-timezone Asia/Yekaterinburg
iptables -t nat -A POSTROUTING -o ens20 -s 0/0 -j MASQUERADE
iptables-save > /etc/sysconfig/iptables
systemctl enable --now iptables
```

</details>

---

<details>
<summary>HQ-RTR</summary>

```
hostname hq-rtr
ip domain-name au-team.irpo
ntp timezone utc+5
username net_admin
	role admin
	password P@ssw0rd
exit
port te0
	service-instance te0/int0
	encapsulation untagged
	exit
exit
port te1
	service-instance te1/int1
		encapsulation dot1q 100
		rewrite pop 1
		exit
	service-instance te1/int2
		encapsulation dot1q 200
		rewrite pop 1
		exit
	service-instance te1/int3
		encapsulation dot1q 999
		rewrite pop 1
		exit
	exit
int int0
	ip address 172.16.1.2/28
	ip nat outside
	connect port te0 service-instance te0/int0
	exit
int int1
	ip address 192.168.1.1/27
	ip nat inside
	connect port te1 service-instance te1/int1
	exit
int int2
	ip address 192.168.2.1/28
	ip nat inside
	connect port te1 service-instance te1/int2
	exit
int int3
	ip address 192.168.99.1/29
	connect port te1 service-instance te1/int3
	exit
int tunnel.0
	ip address 172.16.0.1/30
	ip mtu 1400
	ip tunnel 172.16.1.2 172.16.2.2 mode gre
	ip ospf authentication-key ecorouter
	exit
router ospf 1
	network 172.16.0.0/30 area 0
	network 192.168.1.0/27 area 0
	network 192.168.2.0/28 area 0
	passive-interface default
	no passive-interface tunnel.0
	area 0 authentication
	exit
ip route 0.0.0.0 0.0.0.0 172.16.1.1
ip nat pool NAT_POOL 192.168.1.1-192.168.1.254,192.168.2.1-192.168.2.254
ip nat source dynamic inside-to-outside pool NAT_POOL overload int int0
ip pool cli_pool 192.168.2.10-192.168.2.10
	dhcp-server 1
		pool cli_pool 1
		mask 255.255.255.240
		gateway 192.168.2.1
		dns 192.168.1.10
		domain-name au-team.irpo
		exit
	exit
int int2
	dhcp-server 1
	exit
write
write
```

</details>

---

<details>
<summary>BR-RTR</summary>

---

```
hostname BR-RTR
ip domain-name au-team.irpo
ntp timezone utc+5
username net_admin
	role admin
	password P@ssw0rd
	exit
port te0
	service-instance te0/int0
		encapsulation untagged
		exit
	exit
port te1
	service-instance te1/int1
		encapsulation untagged
		exit
	exit
int int0
	ip address 172.16.2.2/28
	ip nat outside
	connect port te0 service-instance te0/int0
	exit
int int1
	ip address 192.168.3.1/28
	ip nat inside
	connect port te1 service-instance te1/int1
	exit
int tunnel.0
	ip address 172.16.0.2/30
	ip mtu 1400
	ip tunnel 172.16.2.2 172.16.1.2 mode gre
	ip ospf authentication-key ecorouter
	exit
router ospf 1
	network 172.16.0.0/30 area 0
	network 192.168.3.0/28 area 0
	passive-interface default
	no passive-interface tunnel.0
	area 0 authentication
	exit
ip route 0.0.0.0 0.0.0.0 172.16.2.1
ip nat pool NAT_POOL 192.168.3.1-192.168.3.254
ip nat source dynamic inside-to-outside pool NAT_POOL overload int int0
write
write
```

</details>

---

<details>
<summary>HQ-SRV</summary>

---

```
hostnamectl hostname hq-srv.au-team.irpo; exec bash
timedatectl set-timezone Asia/Yekaterinburg
adduser sshuser -u 2026
passwd sshuser
visudo
# WHEEL_USERS ALL=(ALL:ALL) NOPASSWD: ALL/ WHEEL_USERS ALL=(ALL:ALL) NOPASSWD: ALL
gpasswd -a "sshuser" wheel
echo Authorized access only > /etc/openssh/banner
vim /etc/openssh/sshd_config
	Port 2026
	AllowUsers sshuser
	MaxAuthTries 2
	PasswordAuthentication yes
	Banner /etc/openssh/banner
systemctl restart sshd
mkdir /etc/net/ifaces/ens20
vim /etc/net/ifaces/ens20/options
	DISABLED=no
	TYPE=eth
	BOOTPROTO=static
	CONFIG_IPV4=yes
echo 192.168.1.10/27 > /etc/net/ifaces/ens20/ipv4address
echo default via 192.168.1.1 > /etc/net/ifaces/ens20/ipv4route
echo nameserver 8.8.8.8 > /etc/resolv.conf
systemctl restart network
apt-get update && apt-get install dnsmasq -y
vim /etc/dnsmasq.conf
	no-resolv
	domain=au-team.irpo
	server=8.8.8.8
	interface=*
	address=/hq-rtr.au-team.irpo/192.168.1.1
	ptr-record=1.1.168.192.in-addr.arpa,hq-rtr.au-team.irpo
	address=/docker.au-team.irpo/172.16.1.1
	address=/web.au-team.irpo/172.16.2.1
	address=/br-rtr.au-team.irpo/192.168.3.1
	address=/hq-srv.au-team.irpo/192.168.1.10
	ptr-record=10.1.168.192.in-addr.arpa,hq-srv.au-team.irpo
	address=/hq-cli.au-team.irpo/192.168.2.10
	ptr-record=10.2.168.192.in-addr.arpa,hq-cli.au-team.irpo
	address=/br-srv.au-team.irpo/192.168.3.10
vim /etc/hosts
	192.168.1.1	hq-rtr.au-team.irpo
systemctl enable --now dnsmasq
systemctl restart dnsmasq
```

</details>

---

<details>
<summary>BR-SRV</summary>

---

```
hostnamectl hostname br-srv.au-team.irpo; exec bash
timedatectl set-timezone Asia/Yekaterinburg
adduser sshuser -u 2026
passwd sshuser
visudo
# WHEEL_USERS ALL=(ALL:ALL) NOPASSWD: ALL/ WHEEL_USERS ALL=(ALL:ALL) NOPASSWD: ALL
gpasswd -a "sshuser" wheel
echo Authorized access only > /etc/openssh/banner
vim /etc/openssh/sshd_config
	Port 2026
	AllowUsers sshuser
	MaxAuthTries 2
	PasswordAuthentication yes
	Banner /etc/openssh/banner
systemctl restart sshd
mkdir /etc/net/ifaces/ens20
vim /etc/net/ifaces/ens20/options
	DISABLED=no
	TYPE=eth
	BOOTPROTO=static
	CONFIG_IPV4=yes
echo 192.168.3.10/28 > /etc/net/ifaces/ens20/ipv4address
echo default via 192.168.3.1 > /etc/net/ifaces/ens20/ipv4route
echo nameserver 192.168.1.10 > /etc/resolv.conf
systemctl restart network
apt-get update
```

</details>

---

<details>
<summary>HQ-CLI</summary>

---

```
hostnamectl hostname hq-cli.au-team.irpo; exec bash
timedatectl set-timezone Asia/Yekaterinburg
mkdir /etc/net/ifaces/ens20
vim /etc/net/ifaces/ens20/options
	TYPE=eth
	BOOTPROTO=dhcp
systemctl restart network
apt-get update
```

</details>

</details>

---