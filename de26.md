<details>
<summary>1 модуль</summary>

---

<details>
<summary>ISP</summary>

---

```
hostnamectl hostname isp; exec bash
mkdir /etc/net/ifaces/ens20
mkdir /etc/net/ifaces/ens21
mkdir /etc/net/ifaces/ens22
vim /etc/net/ifaces/ens20/options
	DISABLED=no
	TYPE=eth
	BOOTPOROTO=static
	CONFIG_IPV4=yes
cp /etc/net/ifaces/ens20/options /etc/net/ifaces/ens21
cp /etc/net/ifaces/ens20/options /etc/net/ifaces/ens22
vim /etc/net/ifaces/ens20/options
	BOOTPROTO=dhcp
echo 172.16.1.1/28 > /etc/net/ifaces/ens21/ipv4address
echo 172.16.2.1/28 > /etc/net/ifaces/ens22/ipv4address
vim /etc/net/sysctl.conf
	net.ipv4.ip_forward = 0
systemctl restart network
apt-get update && apt-get install iptables -y && apt-get reinstall tzdata -y
timedatectl set-timezone Asia/Yekaterinburg
iptables -t nat -A POSTROUTING -o ens20 -s 0/0 -j MASQUERADE
iptables-save > /etc/sysconfig/iptables
systemctl enable --now iptables
```

</details>

---

<details>
<summary>HQ-RTR</summary>

---
	
```
hostname hq-rtr
ip domain-name au-team.irpo
ntp timezone utc+5
username net_admin
	role admin
	password P@ssw0rd
exit
port te0
	service-instance te0/int0
	encapsulation untagged
	exit
exit
port te1
	service-instance te1/int1
		encapsulation dot1q 100
		rewrite pop 1
		exit
	service-instance te1/int2
		encapsulation dot1q 200
		rewrite pop 1
		exit
	service-instance te1/int3
		encapsulation dot1q 999
		rewrite pop 1
		exit
	exit
int int0
	ip address 172.16.1.4/28
	ip nat outside
	connect port te0 service-instance te0/int0
	exit
int int1
	ip address 192.168.1.1/27
	ip nat inside
	connect port te1 service-instance te1/int1
	exit
int int2
	ip address 192.168.2.1/28
	ip nat inside
	connect port te1 service-instance te1/int2
	exit
int int3
	ip address 192.168.99.1/29
	connect port te1 service-instance te1/int3
	exit
int tunnel.0
	ip address 172.16.0.1/30
	ip mtu 1400
	ip tunnel 172.16.1.4 172.16.2.5 mode gre
	ip ospf authentication-key ecorouter
	exit
router ospf 1
	network 172.16.0.0/30 area 0
	network 192.168.1.0/27 area 0
	network 192.168.2.0/28 area 0
	passive-interface default
	no passive-interface tunnel.0
	area 0 authentication
	exit
ip route 0.0.0.0 0.0.0.0 172.16.1.1
ip nat pool NAT_POOL 192.168.1.1-192.168.1.254,192.168.2.1-192.168.2.254
ip nat source dynamic inside-to-outside pool NAT_POOL overload int int0
ip pool cli_pool 192.168.2.10-192.168.2.10
	dhcp-server 1
		pool cli_pool 1
		mask 255.255.255.240
		gateway 192.168.2.1
		dns 192.168.1.10
		domain-name au-team.irpo
		exit
	exit
int int2
	dhcp-server 1
	exit
write
write
```

</details>

---

<details>
<summary>BR-RTR</summary>

---

```
hostname BR-RTR
ip domain-name au-team.irpo
ntp timezone utc+5
username net_admin
	role admin
	password P@ssw0rd
	exit
port te0
	service-instance te0/int0
		encapsulation untagged
		exit
	exit
port te1
	service-instance te1/int1
		encapsulation untagged
		exit
	exit
int int0
	ip address 172.16.2.5/28
	ip nat outside
	connect port te0 service-instance te0/int0
	exit
int int1
	ip address 192.168.3.1/28
	ip nat inside
	connect port te1 service-instance te1/int1
	exit
int tunnel.0
	ip address 172.16.0.2/30
	ip mtu 1400
	ip tunnel 172.16.2.5 172.16.1.4 mode gre
	ip ospf authentication-key ecorouter
	exit
router ospf 1
	network 172.16.0.0/30 area 0
	network 192.168.3.0/28 area 0
	passive-interface default
	no passive-interface tunnel.0
	area 0 authentication
	exit
ip route 0.0.0.0 0.0.0.0 172.16.2.1
ip nat pool NAT_POOL 192.168.3.1-192.168.3.254
ip nat source dynamic inside-to-outside pool NAT_POOL overload int int0
write
write
```

</details>

---

<details>
<summary>HQ-SRV</summary>

---

```
hostnamectl hostname hq-srv.au-team.irpo; exec bash
timedatectl set-timezone Asia/Yekaterinburg
adduser sshuser -u 2026
passwd sshuser
visudo
# WHEEL_USERS ALL=(ALL:ALL) NOPASSWD: ALL/ WHEEL_USERS ALL=(ALL:ALL) NOPASSWD: ALL
gpasswd -a "sshuser" wheel
echo Authorized access only > /etc/openssh/banner
vim /etc/openssh/sshd_config
	Port 2026
	AllowUsers sshuser
	MaxAuthTries 2
	PasswordAuthentication yes
	Banner /etc/openssh/banner
systemctl restart sshd
mkdir /etc/net/ifaces/ens20
vim /etc/net/ifaces/ens20/options
	DISABLED=no
	TYPE=eth
	BOOTPROTO=static
	CONFIG_IPV4=yes
echo 192.168.1.10/27 > /etc/net/ifaces/ens20/ipv4address
echo default via 192.168.1.1 > /etc/net/ifaces/ens20/ipv4route
echo nameserver 8.8.8.8 > /etc/resolv.conf
systemctl restart network
apt-get update && apt-get install dnsmasq -y
vim /etc/dnsmasq.conf
	no-resolv
	domain=au-team.irpo
	server=8.8.8.8
	interface=*
	address=/hq-rtr.au-team.irpo/192.168.1.1
	ptr-record=1.1.168.192.in-addr.arpa,hq-rtr.au-team.irpo
	address=/docker.au-team.irpo/172.16.1.1
	address=/web.au-team.irpo/172.16.2.1
	address=/br-rtr.au-team.irpo/192.168.3.1
	address=/hq-srv.au-team.irpo/192.168.1.10
	ptr-record=10.1.168.192.in-addr.arpa,hq-srv.au-team.irpo
	address=/hq-cli.au-team.irpo/192.168.2.10
	ptr-record=10.2.168.192.in-addr.arpa,hq-cli.au-team.irpo
	address=/br-srv.au-team.irpo/192.168.3.10
vim /etc/hosts
	192.168.1.1	hq-rtr.au-team.irpo
systemctl enable --now dnsmasq
systemctl restart dnsmasq
```

</details>

---

<details>
<summary>BR-SRV</summary>

---

```
hostnamectl hostname br-srv.au-team.irpo; exec bash
timedatectl set-timezone Asia/Yekaterinburg
adduser sshuser -u 2026
passwd sshuser
visudo
# WHEEL_USERS ALL=(ALL:ALL) NOPASSWD: ALL/ WHEEL_USERS ALL=(ALL:ALL) NOPASSWD: ALL
gpasswd -a "sshuser" wheel
echo Authorized access only > /etc/openssh/banner
vim /etc/openssh/sshd_config
	Port 2026
	AllowUsers sshuser
	MaxAuthTries 2
	PasswordAuthentication yes
	Banner /etc/openssh/banner
systemctl restart sshd
mkdir /etc/net/ifaces/ens20
vim /etc/net/ifaces/ens20/options
	DISABLED=no
	TYPE=eth
	BOOTPROTO=static
	CONFIG_IPV4=yes
echo 192.168.3.10/28 > /etc/net/ifaces/ens20/ipv4address
echo default via 192.168.3.1 > /etc/net/ifaces/ens20/ipv4route
echo nameserver 192.168.1.10 > /etc/resolv.conf
systemctl restart network
apt-get update
```

</details>

---

<details>
<summary>HQ-CLI</summary>

---

```
hostnamectl hostname hq-cli.au-team.irpo; exec bash
timedatectl set-timezone Asia/Yekaterinburg
mkdir /etc/net/ifaces/ens20
vim /etc/net/ifaces/ens20/options
	TYPE=eth
	BOOTPROTO=dhcp
systemctl restart network
apt-get update
```

</details>

---

</details>

---

<details>
<summary>2 модуль</summary>

---

<details>
<summary>ISP</summary>

---

```
apt-get install chrony -y
vim /etc/chrony.conf
	server 127.0.0.1 iburst prefer
	hwtimestamp *
	local stratum 5
	allow 0/0
systemctl enable --now chronyd
chronyc sources
chronyc tracking | grep Stratum

apt-get install nginx apache2-htpasswd -y
htpasswd -bc /etc/nginx/.htpasswd WEB P@ssw0rd
vim /etc/nginx/sites-available.d/proxy.conf
	server {
			listen 80;
			server_name web.au-team.irpo;
			auth_basic "Restricted Access";
			auth_basic_user_file /etc/nginx/.htpasswd;
			location / {
					proxy_pass http://172.16.1.4:8080;
					proxy_set_header Host $host;
					proxy_set_header X-Real-IP $remote_addr;
			}
	}
	server {
			listen 80;
			server_name docker.au-team.irpo;
			location / {
					proxy_pass http://172.16.2.5:8080;
					proxy_set_header Host $host;
					proxy_set_header X-Real-IP $remote_addr;
			}
	}
ln -s /etc/nginx/sites-available.d/proxy.conf /etc/nginx/sites-enabled.d/
mv /etc/nginx/sites-available.d/default.conf /root/
systemctl enable --now nginx
systemctl restart nginx
```
</details>

---

<details>
<summary>HQ-SRV</summary>

---

```
vim /etc/dnsmasq
ᅠ ᅠᅠ ᅠserver=/au-team.irpo/192.168.3.10
systemctl restart dnsmasq
```

<img width="745" height="359" alt="creating_disks" src="https://github.com/user-attachments/assets/7bd007fd-2d5a-4a95-be9a-b5e669585a96" />

```
lsblk
```

<img width="372" height="131" alt="check_disks" src="https://github.com/user-attachments/assets/2f663744-5399-4924-9b29-19179cd98385" />

```
mdadm --create /dev/md0 --level=0 --raid-devices=2 /dev/sd[b-c]
mdadm --detail -scan --verbose > /etc/mdadm.conf
apt-get update && apt-get install fdisk nfs-server -y
fdisk /dev/md0
```

<img width="1116" height="748" alt="options_raid" src="https://github.com/user-attachments/assets/6ad65ab6-325d-48ea-b05f-49306cfb007e" />

```
mkfs.ext4 /dev/md0p1
vim/etc/fstab
	/dev/md0p1		/raid		ext4		defaults		0		0
mkdir /raid
mount -a
mkdir /raid/nfs
chown 99:99 /raid/nfs
chmod 777 /raid/nfs
vim /etc/exports
	/raid/nfs 192.168.2.0/28(rw,sync,no_subtree_check)
exportfs -a
exportfs -v
systemctl enable --now nfs
systemctl restart nfs

apt-get install chrony -y
vim /etc/chrony.conf
	(all delete)
	server 172.16.1.1 iburst prefer
systemctl enable --now chronyd
chronyc sources
timedatectl



apt-get install lamp-server -y
mount -o loop /dev/sr0
cp /media/ALTLinux/web/index.php /var/www/html
cp /media/ALTLinux/web/logo.png /var/www/html
vim /www/html/index.php
	$servername = "localhost";
	$username = "webc";
	$password = "P@ssw0rd";
	$dbname = "webdb";
systemctl enable --now mariadb
mariadb -u root
	CREATE DATABASE webdb;
	CREATE USER 'webc'@'localhost' IDENTIFIED BY 'P@ssw0rd';
	GRANT ALL PRIVILEGES ON webdb.* TO 'webc'@'localhost';
	FLUSH PRIVILEGES;
	exit
mariadb -u root -D webdb < /media/ALTLinux/web/dump.sql
systemctl enable --now httpd2
```

</details>

---

<details>
<summary>BR-SRV</summary>

---

```
apt-get update && apt-get install task-samba-dc -y
vim /etc/resolv.conf
	nameserver 192.168.1.10
rm -rf /etc/samba/smb.conf
vim /etc/hosts
	192.168.3.10 br-srv.au-team.irpo
samba-tool domain provision
mv -f /var/lib/samba/private/krb5.conf /etc/krb5.conf
systemctl eanble --now samba
samba-tool user add hquser1 P@ssw0rd
samba-tool user add hquser2 P@ssw0rd
samba-tool user add hquser3 P@ssw0rd
samba-tool user add hquser4 P@ssw0rd
samba-tool user add hquser5 P@ssw0rd
samba-tool group add hq
samba-tool group addmembers hq hquser1,hquser2,hquser3,hquser4,hquser5
apt-repo add rpm http://altrepo.ru/local-p10 noarch local-p10
apt-get update && apt-get install sudo-samba-schema -y
sudo-schema-apply
	(da)
	(Administrator P@ssw0rd)
	(da)
create-sudo-rule
```

<img width="691" height="519" alt="createing_rule" src="https://github.com/user-attachments/assets/f846658e-5e80-40a9-b502-1731669da2e7" />

```
apt-get install chrony -y
vim /etc/chrony.conf
	server 172.16.2.1 iburst prefer
systemctl eanble --now chronyd
chronyc sources
timedatectl

apt-get install ansible -y
vim /etc/ansible/hosts
	[servers]
	HQ-SRV ansible_host=192.168.1.10
	HQ-CLI ansible_host=192.168.2.10
	[servers:vars]
	ansible_user=sshuser
	ansible_port=2026
	[routers]
	HQ-RTR ansible_host=192.168.1.1
	BR-RTR ansible_host=192.168.3.1
	[routers:vars]
	ansible_user=net_admin
	ansible_password=P@ssw0rd
	ansible_connection=network_cli
	ansible_network_os=ios
vim /etc/ansible/ansible.cfg
	[defaults]
	interpreter_python=auto_silent
ssh-keygen -t rsa
ssh-copy-id -p 2026 sshuser@192.168.1.10
ssh-copy-id -p 2026 sshuser@192.168.2.10
ansible all -m ping






local (AltPVE) > ISO Images > Upload > File > Upload

Hardware > Add > CD/DVD Drive > Storage: local; ISO image: Additional.iso > Add

apt-get install docker-compose-v2 docker-engine -y
systemctl enable --now docker

mount -o loop /dev/sr0 /mnt/
docker load < /mnt/docker/site_latest.tar
docker load < /mnt/docker/mariadb_latest.tar
docker images
vim docker-compose.yml
	services:
		db:
			image: mariadb
			container_name: db
			environment:
				MARIADB_ROOT_PASSWORD: "P@ssw0rd"
				MARIADB_DATABASE: "testdb"
				MARIADB_USER: "test"
				MARIADB_PASSWORD: "P@ssw0rd"
			restart: always
		testapp:
			image: site
			container_name: testapp
			environment:
				DB_TYPE: "maria"
				DB_HOST: "db"
				DB_NAME: "testdb"
				DB_USER: "test"
				DB_PASS: "P@ssw0rd"
				DB_PORT: "3306"
			ports:
				- "8080:8000"
			depends_on:
				- db
			restart: always
docker compose up -d
```

</details>

---

<details>
<summary>HQ-RTR</summary>

---

```
ntp server 172.16.1.1
ntp timezone utc+5
show ntp status
ip nat source static tcp 192.168.1.10 80 172.16.1.2 8080
ip nat source static tcp 192.168.1.10 2026 172.16.1.2 2026
write memory
```

</details>

---

<details>
<summary>BR-RTR</summary>

---

```
ntp server 172.16.2.1
ntp timezone utc+5
show ntp status
ip nat source static tcp 192.168.3.10 8080 172.16.2.2 8080
ip nat source static tcp 192.168.3.10 2026 172.16.2.2 2026
write memory
```

</details>

---

<details>
<summary>HQ-CLI</summary>

---

```
useradd sshuser -u 2026
passwd sshuser
visudo
gpasswd -a "sshuser" wheel
vim /etc/openssh/sshd_config
	Port 2026
	AllowUsers sshuser
	MaxAuthTries 2
	PasswordAuthentication yes
	Banner /etc/openssh/banner
vim /etc/openssh/banner
	Authorized access only
systemctl restart sshd
```

<img width="978" height="678" alt="Добавление HQ-CLI в домен" src="https://github.com/user-attachments/assets/c1810895-89e5-4a80-ad64-5a10bea3e341" />
<img width="978" height="244" alt="Добавление hq-cli в домен 1" src="https://github.com/user-attachments/assets/ca68baca-433d-4051-b70b-547e89f0b77a" />
<img width="607" height="353" alt="Добавление hq-cli в домен 2" src="https://github.com/user-attachments/assets/e7fca92c-f2f4-41d4-ab01-52b99d198afb" />
<img width="533" height="315" alt="Добавление hq-cli в домен 3" src="https://github.com/user-attachments/assets/4d0a5fd4-9376-4606-a6c6-c8d6bf37d332" />

```
apt-get install admc libsss_sudo nfs-clients chrony yandex-browser -y
kinit administrator
admc
```

<img width="642" height="283" alt="Изменения правил(1)" src="https://github.com/user-attachments/assets/e580a013-d4f0-453f-b6d1-ba40f7eda283" />
<img width="1079" height="536" alt="Изменение правил(2)" src="https://github.com/user-attachments/assets/1671aeb8-0338-4dcb-89f7-fd5592e8f549" />
<img width="837" height="529" alt="Изменение правил(3)" src="https://github.com/user-attachments/assets/aab80845-c78a-42a8-9981-473a236bbfbe" />
<img width="624" height="508" alt="Изменение правил(4)" src="https://github.com/user-attachments/assets/ca97982a-a435-4173-8806-d1fb54bf4b32" />

```
control sudo public
vim /etc/sssd/sssd.conf
```

<img width="494" height="82" alt="Настройка SSSD" src="https://github.com/user-attachments/assets/616f8144-61ab-47e2-b4b9-d9775992cba0" />
<img width="494" height="290" alt="Настройка файла SSSD" src="https://github.com/user-attachments/assets/e3c7ea08-51ae-4203-810a-fa85ea776d72" />

```
vim /etc/nsswitch.conf
```

<img width="374" height="54" alt="Настройка nsswith" src="https://github.com/user-attachments/assets/8a7c30b9-d9ff-4669-8431-cf3ff80c95cb" />

```
rm -rf /var/lib/sss/db/*
sss_cache -E
systemctl restart sssd
sudo -l -U hquser1
sudo cat /etc/passwd | sudo grep root && sudo id root
```

<img width="1384" height="200" alt="Проверка sudo" src="https://github.com/user-attachments/assets/89a6dec3-fe91-44b1-b40b-003d1412278e" />

```
mkdir -p /mnt/nfs
vim /etc/fstab
	192.168.1.10:/raid/nfs		/mnt/nfs		nfs		intr,soft,_netdev,x-systemd.automount		0		0
```

<img width="780" height="162" alt="Настройка fstab cli" src="https://github.com/user-attachments/assets/b057d0a7-2fec-4e5a-94e3-8db714b45d19" />

```
mount -a
mount -v
touch /mnt/nfs/test
vim /etc/chrony.conf
	server 172.16.1.1 iburst prefer
systemctl enable --now chronyd
chronyc sources
```

</details>

---

</details>

---












